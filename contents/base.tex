\chapter{予備知識} \label{chap:markup}

\section{構造化マークアップ} \label{sec:markup}

マークアップ方式文書を作成する際，文書の論理的構造とそれを紙面に表示する際の視覚的効果（すなわち体裁）は，
明確に分離して記述するのが望ましいとされることが多い．
それを強調する意味で，マークアップを特に%
\term{構造化マークアップ}%
\index[widx]{こうぞうかマークアップ@構造化マークアップ}%
と呼ぶことがある．
構造化マークアップが重要視される理由は文脈によってさまざまであるが，{\LaTeX}と関係するのはおおむね以下のようなものである：
\begin{itemize}
    \item 文書の体裁を定義する部分が本文とは分離されているため，体裁のみの変更が容易となる．
    \item あらかじめ体裁を定義する部分を切り出してパッケージ化しておくことにより，ユーザーが自ら体裁を定義する必要がなくなる．
\end{itemize}
特に後者は重要である．
体裁の定義は処理系の低レベルな部分に触れなければできないことも多く，その処理系に対する深い知識が要求されることが多い．
そのような知識を一般ユーザーに求めるようでは，そのツールは不便であると言わざるを得ない．

{\LaTeX}では，基本的にドキュメントクラス内で文書の全体的な体裁が定義されている．
有志がドキュメントクラスを開発してくれるおかげで，
ユーザーは文書の論理的構造をソースに記述するだけで「いい感じ」の文書が作成できるのである．
このことが理由で{\LaTeX}を使用するユーザーも決して少なくはないだろう．
他にも，
\term{パッケージ}%
\index[widx]{パッケージ@パッケージ}%
\footnote{%
ここでは，
\cs{usepackage}%
コマンドで読み込むことができるパッケージファイルのことを指している．
}%
という形で提供される拡張機能を読み込むことにより，
{\LaTeX}をさらに便利に使うことができるのは周知のとおりである．

\section{コマンドの定義による構造化マークアップ} \label{sec:exampleinlatex}

さて，与えられたドキュメントクラスやパッケージを活用するだけでは，自分のニーズを完璧に満たせるとは限らない．
そのニーズ自体が{\LaTeX}を使用するうえで不適切である場合%
\footnote{%
例えば，図を自分の思う通りの場所に配置したいというニーズはそもそも組版上不適切であることが多い．
}%
を除けば，新しいコマンドや環境を定義したり，既存のコマンドや環境の定義を変更することで解決されるべきである．
もちろん，技術的な難易度の問題で解決できないこともあるが，簡単に解決できることも多い．
例を挙げよう．

\begin{Ex} \label{Ex:cpp}
    プログラミング言語「{\cpp}」のロゴを出力したいとき，
    そのまま「\lstinline|C++|」と入力しても（Latin Modern Romanフォント採用時には）「{\fontspec{Latin Modern Roman}C++}」と表示されてしまい，
    非常に不格好である．
    
    採用するフォントや好みによるところも大きいが，例えば
    \inputonly{samplecode/cpp}
    のようにいくらかの微調整を加えてやることで，出力が（Latin Modern Romanフォント採用時には）
    「{\fontspec{Latin Modern Roman}\input{samplecode/cpp}}」のようになり，いくらか改善する．
    これを本文に適用したいところであるが，まさかソース中の該当箇所をそのままこれに置き換えようなどとは思うまい．
    置き換えた後に「微調整」の内容を変更した際，ソース中の該当箇所すべてを変更する必要が生じるからである．
    当然修正漏れの可能性もある．例えば「\cs{cpp}」のようなコマンドを上記微調整の結果として定義し，
    本文中では「\cs{cpp}」のように記述すべきである．
\end{Ex}

\cref{Ex:cpp}で挙げたのは，必要とされた特殊な装飾を本文中から外に隔離する例である．
このようにすることで，本文中では「\cs{cpp}」のように，すっきりした記述にできる．

重要なのはそれだけではない．本文中での記述から\cs{hspace}や\cs{raisebox}といった
「余計なもの」が排除され，「\cs{cpp}」という「意図」のみになっている．
これにより，ソースを読むだけで「何を書きたいのか」がすぐにわかる．
書いてすぐならば多少ごちゃごちゃした記述であっても意図を忘れることは多くないだろうが，
時間が経った後に自分が書いたソースを見返した場合に何が書いてあるのかまったくわからなくなる．
「そのようなことを考えるのは面倒だしどうせ見返すようなことなどないのだから，ソースは書き捨てでよい」などと
考えてはいけない．このようなtipsは定期的に再利用したくなるものである．

「意図をはっきりさせる」ことは，異なる意図ではあるが結果的に体裁が同じになった場合に特に有用である．

\begin{Ex} \label{Ex:intention}
    新出の単語も強調も太字で書くことはよくある．強調の場合は標準で用意されている\cs{emph}コマンドを使うべきである．
    ここで，新出の単語も\cs{emph}コマンドを使ってしまうと，ソース中で両者を見分けることができなくなってしまう．
    そのため，新出の単語を示すために例えば\cs{term}といったコマンドを用意することで，両者を区別することが容易になる．

    ただし，「新出の単語を太字表記するのは強調のためで，そこに意味の違いはない．
    その証拠に，新出の単語であっても重要でないものは太字表記しないではないか」と考えるのであれば，
    両者を区別せずに\cs{emph}コマンドで統一するのは理にかなっている．
\end{Ex}

さて，\cref{Ex:intention}で取り上げた\cs{emph}コマンド%
\index[cidx]{emph@\cs{emph}}%
に関して，誤ったtipsが広まってしまっているようである．

\begin{Ex} \label{Ex:changedef}
    強調の際には\cs{emph}というコマンドを使う．ところが，
    この\cs{emph}コマンドは（環境にもよるが）
    「和文はゴシック体にするが，欧文はイタリック体にする」という挙動を示す．
    \inputonly{samplecode/emph}
    とすれば「\input{samplecode/emph}」のような出力が得られる． 
    
    この挙動を嫌がったせいか「強調には直接\cs{textbf}コマンドを使ってしまえ」という誤ったtipsが横行している．
    この場合，当然\cs{emph}コマンドの定義を変更するのが正しい．
\end{Ex}

以降，これを{\LaTeX}で実装するための具体的な方法を考えよう．